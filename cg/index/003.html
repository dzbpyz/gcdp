<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="../static/js/boot.js" type="text/javascript"></script>
    <link href="../static/css/base.css" type="text/css" rel="stylesheet">
    <style type="text/css">
        /* ... (您的 CSS 样式保持不变) ... */
        #FHDATE::placeholder { color: #cccccc; opacity: 1; }
        #FHDATE:-ms-input-placeholder { color: #cccccc; }
        #FHDATE::-ms-input-placeholder { color: #cccccc; }
        #custom-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1000; }
        #custom-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); z-index: 1001; min-width: 300px; max-width: 90%; border: 1px solid #ccc; text-align: left; }
        #custom-modal-message { margin-bottom: 20px; font-size: 16px; line-height: 1.5; color: #333333; font-family: 宋体, Arial, sans-serif; }
        #custom-modal-close { display: block; margin: 0 auto; padding: 10px 25px; background-color: #2e9be2; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-family: 宋体, Arial, sans-serif; }
        #custom-modal-close:hover { background-color: #257cb6; }
    </style>

    <script type="text/javascript">
        function validateCertificate() {
            var certificateNumberInput = document.getElementById('ZLZMSBH');
            var certificateNumber = certificateNumberInput.value.trim();
            console.log("DEBUG: Input certificateNumber:", certificateNumber);

            if (certificateNumber === "") {
                console.log("DEBUG: Input is empty. Refreshing.");
                window.location.reload();
                return;
            }

            // !!! 重要：确认文件后缀名 !!!
            // 如果您的文件名是 "20250527" (没有 .html)，请将下面这行改为:
            // var targetFileName = certificateNumber;
            // 如果有其他后缀，例如 ".txt"，请改为:
            // var targetFileName = certificateNumber + ".txt";
            var targetFileName = certificateNumber + ".html"; // 当前假设是 .html 后缀

            var targetUrl = "../search/" + targetFileName;
            console.log("DEBUG: Target URL constructed:", targetUrl);

            fetch(targetUrl, { method: 'GET', cache: 'no-store' }) // 添加 cache: 'no-store' 避免缓存问题
                .then(response => {
                    console.log("DEBUG: Fetch response received.");
                    console.log("DEBUG: Response status:", response.status);
                    console.log("DEBUG: Response ok (200-299 range):", response.ok);
                    console.log("DEBUG: Response redirected (was there a 30x redirect?):", response.redirected);
                    console.log("DEBUG: Response final URL (after any redirects):", response.url);

                    // 将相对的 targetUrl 和 response.url 都转换为绝对路径的 pathname 进行比较
                    const absoluteTargetBasePath = new URL("../search/", window.location.href).pathname;
                    const expectedFinalPath = absoluteTargetBasePath + targetFileName;
                    const actualFinalPath = new URL(response.url, window.location.href).pathname;

                    console.log("DEBUG: Expected final path (calculated):", expectedFinalPath);
                    console.log("DEBUG: Actual final path (from response.url):", actualFinalPath);
                    
                    // 路径检查：确保最终访问的路径是我们期望的路径
                    // （允许一些细微差别，例如服务器自动添加的尾部斜杠，但基本路径和文件名应一致）
                    const isPathMatching = actualFinalPath.startsWith(absoluteTargetBasePath) && actualFinalPath.endsWith(targetFileName);
                    // 更宽松的检查，如果服务器可能在文件名和目录间添加/删除斜杠
                    const isPathRoughlyMatching = actualFinalPath.includes("/search/" + targetFileName);


                    console.log("DEBUG: Path matching (strict endsWith targetFileName)?", actualFinalPath.endsWith(targetFileName));
                    console.log("DEBUG: Path matching (rough includes /search/targetFileName)?", isPathRoughlyMatching);


                    if (!response.ok || !isPathRoughlyMatching) {
                        console.warn("DEBUG: Condition for refresh met: !response.ok OR !isPathRoughlyMatching.");
                        console.warn("DEBUG: !response.ok value:", !response.ok);
                        console.warn("DEBUG: !isPathRoughlyMatching value:", !isPathRoughlyMatching, "(actual: " + actualFinalPath + ", expected contains: /search/" + targetFileName + ")");
                        window.location.reload();
                        // 返回一个被拒绝的 Promise 来中断后续的 .then()
                        return Promise.reject({
                            type: 'fetch_error_or_path_mismatch',
                            message: 'File not found, server error, or final URL path mismatch. Status: ' + response.status + ', Final URL: ' + response.url
                        });
                    }

                    console.log("DEBUG: Response seems OK and path matches. Getting text content...");
                    return response.text();
                })
                .then(fileContent => {
                    // 如果前面的 Promise 被 reject，这里不会执行，fileContent 会是 undefined (或者 reject 的值)
                    if (typeof fileContent !== 'string') {
                        // 通常意味着前面的 Promise.reject 被调用了
                        console.log("DEBUG: fileContent is not a string, likely due to earlier Promise.reject. Skipping content check.");
                        return;
                    }
                    console.log("DEBUG: File content fetched successfully. Length:", fileContent.length);
                    console.log("DEBUG: File content (first 200 chars):", fileContent.substring(0, 200) + (fileContent.length > 200 ? "..." : ""));

                    // !!! 重要：检查这些关键字是否存在于您的目标文件中 !!!
                    const keywordsToVerify = [
                        "产品质量证明书",
                        "河钢股份有限公司承钢分公司",
                        "批次编号",
                        // "HRB400E" // 示例：确保这些关键字在目标文件中确实存在，大小写敏感
                    ];
                    console.log("DEBUG: Keywords to verify:", keywordsToVerify);

                    let isValidFile = false;
                    let foundKeyword = null;
                    for (const keyword of keywordsToVerify) {
                        if (fileContent.includes(keyword)) {
                            isValidFile = true;
                            foundKeyword = keyword;
                            break; // 找到一个关键字即可
                        }
                    }

                    console.log("DEBUG: Is file content valid based on keywords?", isValidFile);
                    if (isValidFile) {
                        console.log("DEBUG: Found keyword:'", foundKeyword, "'. Navigating to:", targetUrl);
                        window.location.href = targetUrl; // 跳转
                    } else {
                        console.warn("DEBUG: No matching keywords found in file content. Refreshing current page.");
                        window.location.reload(); // 刷新
                    }
                })
                .catch(error => {
                    console.error("DEBUG: CATCH BLOCK - An error occurred:", error);
                    // 避免因为我们主动 reject 而导致的重复刷新
                    if (error && error.type === 'fetch_error_or_path_mismatch') {
                        console.log("DEBUG: Catch handled 'fetch_error_or_path_mismatch'. Refresh was already called.");
                    } else {
                        // 对于其他未预料的错误
                        console.error("DEBUG: Unhandled error in catch block, refreshing page as a fallback.");
                        window.location.reload();
                    }
                });
        }

        // 其他辅助函数保持不变
        function online_print() { console.log("online_print 被调用"); showCustomModal("在线打印功能正在开发中或需要特定权限。请联系客服经理获取打印权限。"); }
        function online_fankui() { console.log("online_fankui 被调用"); var link = document.getElementById('online_fankui_link'); if (link) window.open(link.href, '_blank');}
        function showDialoghuaxue() { showCustomModal("化学成分信息暂未提供。"); }
        function showDialogwuli() { showCustomModal("物理性能信息暂未提供。"); }
        function showCustomModal(message) { document.getElementById('custom-modal-message').innerText = message; document.getElementById('custom-modal-overlay').style.display = 'block'; document.getElementById('custom-modal').style.display = 'block'; }
        function closeCustomModal() { document.getElementById('custom-modal-overlay').style.display = 'none'; document.getElementById('custom-modal').style.display = 'none'; }

    </script>
</head>
<body>
    <!-- ... (您的 HTML body 保持不变) ... -->
    <div id="custom-modal-overlay"></div>
    <div id="custom-modal">
        <p id="custom-modal-message"></p>
        <button id="custom-modal-close" onclick="closeCustomModal()">确定</button>
    </div>

		<div size="100%" showcollapsebutton="true"  style="border:10px solid #000">
				   <form id="searchkey" method="post">
				   		<table  border="0" cellpadding="0" cellspacing="0">
				   	    <tr>
				   	    	 <td><img align="absmiddle" src="../static/picture/logo.png" style="text-align:left;" /></td>
							 <td colspan="4" style="text-align: center; "><font style="font-size:30px;vertical-align:middle;font-weight :bold;font-family: 宋体;">河钢股份有限公司承钢分公司</font></td>
				   	    </tr>
				   	    </table>
						<table class="mtable" border="0" cellpadding="1" cellspacing="2" >
							<tr><td colspan="4" style="font-size:26px;color: #fff;background-color: #2e9be2;height:40px;">产品基本信息</td></tr>
							<tr><td style="text-align: center;font-size:20px;font-family: 宋体;">产品名称：</td><td colspan="3" >带肋盘螺</td></tr>
							<tr><td style="font-size:20px;font-family: 宋体;">批次编号：</td><td style="text-align: left"  colspan="3">25Y200885M20250122020757 </td></tr>
	                        <tr><td style="text-align: center;font-size:20px;font-family: 宋体;">捆  号：</td><td id="khValueCell" style="text-align: center">   <span id="khDynamicSuffix">2</span> </td><td style="text-align: center;font-size:20px;font-family: 宋体;">材  质：</td><td style="text-align: center">HRB400E </td></tr>
							<tr><td style="text-align: center;font-size:20px;font-family: 宋体;">规  格：</td><td style="text-align: center">   Φ8.0</td><td style="text-align: center;font-size:20px;font-family: 宋体;">支  数：</td><td style="text-align: center"> </td></tr>
							<tr><td style="text-align: center;font-size:20px;font-family: 宋体;">长  度(m)：</td><td style="text-align: center"> </td><td style="text-align: center;font-size:20px;font-family: 宋体;">理  重(kg)：</td><td style="text-align: center"> </td></tr>
							<tr><td style="text-align: center;font-size:20px;font-family: 宋体;">实  重(kg)：</td><td style="text-align: center; min-width: 200px;"> <span id="szDynamicValue"> </span></td><td style="text-align: center;font-size:20px;font-family: 宋体;">产出日期：</td><td style="text-align: center; min-width: 200px;"> 2025-01-22</td></tr>
							<tr><td colspan="4" style=";font-size:26px;color: #fff;background-color: #2e9be2;height:40px;">产品质量证明书查验及在线打印</td></tr>
							<tr>
							    <td colspan="1" style="text-align: right;font-size:20px;font-family: 宋体;">质量证明书编号：</td>
							    <td style="text-align: left"  colspan="2"><input id="ZLZMSBH" name="ZLZMSBH"  style="width: 100%" required="true" /></td>
							    <td rowspan="2" style="text-align: left; vertical-align: middle;"><img src="../static/picture/chaxun.jpg" onclick="validateCertificate()" style="cursor:pointer;" alt="查询" /></td>
							</tr>
							<tr>
							    <td  colspan="1" style="text-align: right;font-size:20px;font-family: 宋体;" >发货日期：</td>
							    <td style="text-align: left"  colspan="2"><input id="FHDATE" name="FHDATE" placeholder="YYYY-MM-DD" vtype="date:yyyy-MM-dd" required="true"  format="yyyy-MM-dd " showOkButton="true" showClearButton="false" style="width: 100%" /></td>
							</tr>
							<tr><td colspan="2" style="font-size:15px;color:red;border-right:none"></td><td colspan="2" style="font-size:15px;color:red;border-left:none">※请输入所持证明书信息查验</td></tr>
							<tr><td  colspan="1" style="font-family: 宋体;text-align: right;font-size:20px;height:40px;border-bottom:none;border-right:none">质量证明书打印：</td><td colspan="3" style="text-align: center;border-bottom:none;border-left:none"><input type="button" value="在线打印入口" onclick="online_print()"  style="width: 320px;height:100%;background: #2e9be2;color:#fff;font-size: 20px;font-family: 宋体;border:#ccc" />   请联系客服经理获取打印权限</td></tr>
							<tr><td colspan="4" style="font-weight:bold;font-size:12px;height:40px;text-align: center;border-top:none">电脑端网址：<a  id = "online_print_link" href="http://cgcgw.cdvt.com.cn:89/cgcg/checkLogin.do" target="_blank">http://cgcgw.cdvt.com.cn:89/cgcg/checkLogin.do</a></td></tr>
							<tr><td colspan="4" style="font-family: 宋体;font-weight:bold;font-size:26px;color: #fff;background-color: #2e9be2;height:40px;">产品问题反馈</td></tr>
							<tr><td colspan="4" style="font-weight:bold;font-size:16px;height:40px;text-align: center;border-bottom:none">欢迎使用河钢客户服务中心信息反馈系统  <img src="../static/picture/fankui.jpg" onclick="online_fankui()" style="cursor:pointer; vertical-align: middle;"></td></tr>
							<tr><td colspan="4" style="font-weight:bold;font-size:12px;height:40px;text-align: center;border-top:none">电脑端网址：<a id="online_fankui_link" href="http://sale.hbistc.com/saleweb/crmWeChat/feedBack.htm" target="_blank">http://sale.hbistc.com/saleweb/crmWeChat/feedBack.htm</a></td></tr>
							<tr><td colspan="2" style="text-align: center;border-bottom:none;border-left:none;"><input type="button" value="化学成分" onclick="showDialoghuaxue()"  style="width: 450px;height:40px;background: #0000FF;color:#fff;font-size:26px;font-family: 宋体;border:#ccc" /></td><td colspan="2" style="text-align: center;border-bottom:none;border-left:none;"><input type="button" value="物理性能" onclick="showDialogwuli()"  style="width: 450px;height:40px;background: #0000FF;color:#fff;font-size:26px;font-family: 宋体;border:#ccc" /></td></tr>
							<tr><td colspan="4" style="font-family: 宋体;font-weight:bold;font-size:26px;color: #fff;background-color: #2e9be2;height:40px;">企业简介——河钢承钢</td></tr>
							<tr><td colspan="4" style="font-family: 宋体;text-indent: 2em;text-align: justify;border-bottom:none;border-top:none" > 河钢集团有限公司（简称“河钢集团”、“河钢”）于2008年6月30日组建成立，拥有直属子分公司20余家，目前已经发展成为以钢铁为主业，矿山资源、金融服务、装备制造、现代物流等相关产业协同发展的产业格局。2019年居世界500强第214位。目前，集团具备5000万吨世界先进装备水平、国内领先节能环保水平的钢铁产能。</td></tr>
							<tr><td colspan="4" style="font-family: 宋体;text-indent: 2em;text-align: justify;border-bottom:none;border-top:none" > 河钢集团承钢公司（简称“河钢承钢”）1954年建厂，是国家“一五”期间苏联援建的156个项目之一，是世界500强企业河钢集团的一级骨干子公司。河钢承钢是依托承德地区丰富的钒钛磁铁矿资源、依靠自主创新建设发展起来的大型钒钛钢铁材料企业，是中国钒钛磁铁矿高炉冶炼和钒提取加工技术的发祥地，钒钛资源综合开发利用产业化技术处于世界领先水平,被誉为中国北方钒都。</td></tr>
							<tr><td colspan="4" style="font-family: 宋体;font-family: 宋体;text-indent: 2em;text-align: justify;border-bottom:none;border-top:none" > 自二十世纪九十年代以来，河钢承钢不断加强了管理，严格按照管理体系标准，建立了质量、测量、能源、环境、职业健康安全、两化融合、知识产权管理体系，并以此持续改进管理。</td></tr>
							<tr><td colspan="4" style="text-indent: 2em;text-align: justify;border-top:none" > 河钢承钢含钒合金钢铁产品包括含钒棒、线、板、带四大系列，具有强度高、韧性好、耐腐蚀、易焊接、深冲性优等优良特性，多个产品被评为全国冶金产品实物质量金杯奖、冶金行业品质卓越产品、河北省名牌产品。河钢承钢是“燕山牌”螺纹钢产品的源产地，其生产的Φ6～Φ50mm全规格、全等级含钒高强螺纹钢筋产品全部荣获全国冶金产品实物质量“金杯奖”，产品广泛应用于国内外标志性建筑、超高层建筑、核电、大跨度桥梁、高铁等工程项目。</td></tr>
							<tr><td colspan="4" style="font-weight:bold;font-size:26px;border-bottom:none ">企业荣誉</td></tr>
							<tr><td colspan="4" style="text-indent: 2em;border-top:none" ><img src="../static/picture/qyry.png" /></td></tr>
							<tr><td colspan="4" style="font-weight:bold;font-size:26px;border-bottom:none">产品范围</td></tr>
							<tr><td colspan="4" style="text-indent: 2em;border-top:none" ><img src="../static/picture/cpfw.png" /></td></tr>
							<tr><td colspan="4" style="font-weight:bold;font-size:26px;border-bottom:none;">联系我们</td></tr>
							<tr><td colspan="4" style="font-size:15px;border-bottom:none;border-top:none" ><img align="absmiddle" src="../static/picture/hbis.png"  /></td></tr>
							<tr><td colspan="4" style="font-family: 宋体;font-size:15px;border-bottom:none;border-top:none" >地址：河北省承德市双滦区滦河镇钢城路1号</td></tr>
							<tr><td colspan="4" style="font-family: 宋体;font-size:15px;border-bottom:none;border-top:none" >网址：http：//www.cdsteel.cn</td></tr>
							<tr><td colspan="4" style="font-family: 宋体;font-size:15px;border-bottom:none;border-top:none" >服务电话：+86-0314-4078888 客服专线：400-188-8286</td></tr>
                            <tr><td colspan="4" style="font-size:15px;" ><img src="../static/picture/hbisewm.png" /></td></tr>
						</table>
						</form>
		</div>
</body>
</html>